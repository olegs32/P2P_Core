# CAdES Plugin - Self-Hosted Digital Signature Service

–°–∞–º–æ–ø–∏—Å–Ω—ã–π –∞–Ω–∞–ª–æ–≥ CAdES plugin –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å—å—é (–≠–¶–ü) –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

## üåü –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (AES-256-GCM)
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **JavaScript API** - –ø—Ä–æ—Å—Ç–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PKCS#12** - –∏–º–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏–∑ .pfx/.p12 —Ñ–∞–π–ª–æ–≤
- **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π** - CAdES-BES —Ñ–æ—Ä–º–∞—Ç (–æ—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π
- **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Linux, Windows, macOS
- **–ë–µ–∑ –ø–ª–∞–≥–∏–Ω–æ–≤** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ActiveX, NPAPI –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ë—Ä–∞—É–∑–µ—Ä (Client)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  JavaScript Library (cades-plugin.js)              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - importCertificate()                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - signData()                                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - verifySignature()                               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ HTTPS/JSON-RPC
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              P2P Core + CAdES Plugin Service            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Python Backend (main.py)                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Certificate management                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Cryptographic operations                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Signature creation/verification                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Secure Storage (AES-256-GCM)                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  user_certs/                                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ {thumbprint}.p12    (PKCS#12 files)          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ {thumbprint}.json   (Metadata)               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å P2P Core:

```bash
python p2p.py --coordinator
```

### 3. –û—Ç–∫—Ä—ã—Ç–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É:

```
https://localhost:8001/static/cades_plugin/index.html
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### –ò–º–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

1. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è" –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª PKCS#12 (.pfx –∏–ª–∏ .p12)
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å
4. –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏

1. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
2. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ (—Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–∞–π–ª)
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞
4. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–ø–∏—Å–∞—Ç—å"
5. –°–∫–∞—á–∞–π—Ç–µ –ø–æ–¥–ø–∏—Å—å

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

1. –í–≤–µ–¥–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø–æ–¥–ø–∏—Å–∏
3. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
4. –£–≤–∏–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å—á–∏–∫–µ

### JavaScript API

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```javascript
const plugin = new CAdESPlugin(
    'https://localhost:8001/rpc',  // API URL
    'your-jwt-token'                // JWT —Ç–æ–∫–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
);
```

#### –ò–º–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```javascript
const fileInput = document.getElementById('pfx-file');
const pfxFile = fileInput.files[0];

const result = await plugin.importCertificate(pfxFile, 'password123');
if (result.success) {
    console.log('Imported:', result.certificate.subject_cn);
    console.log('Thumbprint:', result.certificate.thumbprint);
}
```

#### –°–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```javascript
const result = await plugin.listCertificates();
for (const cert of result.certificates) {
    console.log(`${cert.subject_cn} - Valid: ${plugin.isCertificateValid(cert)}`);
}
```

#### –ü–æ–¥–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö

```javascript
// –ü–æ–¥–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç
const result = await plugin.signData(
    'Hello, World!',
    'A1B2C3D4E5F6...',  // thumbprint
    'password123',
    true                 // detached signature
);

console.log('Signature:', result.signature);

// –ü–æ–¥–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª
const fileInput = document.getElementById('file');
const file = fileInput.files[0];
const result = await plugin.signData(file, thumbprint, password);

// –°–∫–∞—á–∞—Ç—å –ø–æ–¥–ø–∏—Å—å
plugin.downloadSignature(result.signature, 'document.sig');
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

```javascript
// –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∏–∑ —Ñ–∞–π–ª–∞
const sigFileInput = document.getElementById('signature-file');
const signatureBase64 = await plugin.loadSignatureFromFile(sigFileInput.files[0]);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
const result = await plugin.verifySignature('Hello, World!', signatureBase64);

if (result.is_valid) {
    console.log('‚úì Signature is valid');
    console.log('Signer:', result.signature_info.signer_name);
    console.log('Signed at:', result.signature_info.signing_time);
} else {
    console.log('‚úó Signature is invalid');
}
```

### Python API (—á–µ—Ä–µ–∑ proxy)

```python
# –í –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–∏—Å–µ P2P Core

# –ò–º–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
result = await self.proxy.cades_plugin.import_certificate(
    pfx_base64="BASE64_DATA",
    password="password123"
)

# –°–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
certs = await self.proxy.cades_plugin.list_certificates()

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏
signature = await self.proxy.cades_plugin.sign_data(
    data_base64="BASE64_DATA",
    thumbprint="A1B2C3D4...",
    password="password123",
    detached=True
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
result = await self.proxy.cades_plugin.verify_signature(
    data_base64="BASE64_DATA",
    signature_base64="SIGNATURE_DATA"
)
```

## üîß API –º–µ—Ç–æ–¥—ã

### import_certificate

–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏–∑ PKCS#12 —Ñ–∞–π–ª–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `pfx_base64` (str) - Base64-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PKCS#12
- `password` (str) - –ü–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "success": true,
  "certificate": {
    "thumbprint": "A1B2C3D4E5F6...",
    "subject_name": "CN=John Doe, O=Company",
    "issuer_name": "CN=CA, O=Authority",
    "subject_cn": "John Doe",
    "issuer_cn": "CA",
    "valid_from": "2024-01-01T00:00:00",
    "valid_to": "2025-01-01T00:00:00",
    "has_private_key": true,
    "key_usage": ["digitalSignature", "keyEncipherment"]
  }
}
```

### list_certificates

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "success": true,
  "certificates": [...],
  "count": 5
}
```

### get_certificate

–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ –ø–æ –æ—Ç–ø–µ—á–∞—Ç–∫—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `thumbprint` (str) - SHA1 –æ—Ç–ø–µ—á–∞—Ç–æ–∫

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

### delete_certificate

–£–¥–∞–ª–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `thumbprint` (str) - SHA1 –æ—Ç–ø–µ—á–∞—Ç–æ–∫

### sign_data

–°–æ–∑–¥–∞—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `data_base64` (str) - –î–∞–Ω–Ω—ã–µ –≤ Base64
- `thumbprint` (str) - –û—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- `password` (str) - –ü–∞—Ä–æ–ª—å –æ—Ç –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞
- `detached` (bool) - –û—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "success": true,
  "signature": "BASE64_SIGNATURE_DATA",
  "signature_type": "CAdES-BES",
  "signer": "John Doe"
}
```

### verify_signature

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `data_base64` (str) - –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Base64
- `signature_base64` (str) - –ü–æ–¥–ø–∏—Å—å –≤ Base64

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "success": true,
  "is_valid": true,
  "signature_info": {
    "signer_name": "John Doe",
    "signer_thumbprint": "A1B2C3D4...",
    "signing_time": "2024-11-14T12:00:00",
    "signature_type": "sha256WithRSAEncryption"
  }
}
```

### get_public_key

–ü–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ PEM —Ñ–æ—Ä–º–∞—Ç–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `thumbprint` (str) - –û—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- `password` (str) - –ü–∞—Ä–æ–ª—å –æ—Ç PKCS#12

### get_statistics

–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–í—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –∞—Ä—Ö–∏–≤–µ:

- **–ê–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:** AES-256-GCM
- **–î–µ—Ä–∏–≤–∞—Ü–∏—è –∫–ª—é—á–∞:** PBKDF2-HMAC-SHA256
- **–û–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏:** –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ
- **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö

- –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ HTTPS
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü–∞—Ä–æ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è PKCS#12 —Ñ–∞–π–ª–æ–≤
2. –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ backup –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É —á–µ—Ä–µ–∑ firewall
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
5. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å CAdES Plugin

| –§—É–Ω–∫—Ü–∏—è | CAdES Plugin | Self-Hosted CAdES |
|---------|--------------|-------------------|
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ | –¢—Ä–µ–±—É–µ—Ç—Å—è | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è |
| –°–∏—Å—Ç–µ–º–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | –î–∞ | –ù–µ—Ç (–∑–∞—â–∏—â–µ–Ω–Ω–æ–µ) |
| –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ù–µ—Ç | –î–∞ |
| –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å | Windows only | Linux/Windows/Mac |
| API | ActiveX/NPAPI | REST/JSON-RPC |
| –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã | –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |
| –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ù–µ—Ç | –î–∞ |

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ

- Python 3.8+
- P2P Core framework
- 128 MB RAM
- 50 MB –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏

- `cryptography >= 41.0.0` - –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

- `pygost` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ì–û–°–¢ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
- `gost-crypto` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ì–û–°–¢

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∏:** –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π CAdES-BES (–Ω–µ –ø–æ–ª–Ω—ã–π CMS/PKCS#7)
2. **–ê–ª–≥–æ—Ä–∏—Ç–º—ã:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ RSA (–ì–û–°–¢ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫)
3. **–£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:** –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ delete –≤ SecureArchive
4. **Timestamp:** CAdES-T –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (—Ç—Ä–µ–±—É–µ—Ç TSA —Å–µ—Ä–≤–µ—Ä–∞)

## üîÑ Roadmap

- [ ] –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ CMS/PKCS#7
- [ ] CAdES-T —Å timestamp —Å–µ—Ä–≤–µ—Ä–æ–º
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ì–û–°–¢ –† 34.10-2012 –∏ –ì–û–°–¢ –† 34.11-2012
- [ ] –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ USB-—Ç–æ–∫–µ–Ω–æ–≤
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º—É

```html
<!DOCTYPE html>
<html>
<head>
    <script src="js/cades-plugin.js"></script>
</head>
<body>
    <form id="document-form">
        <textarea id="document" name="document"></textarea>
        <select id="certificate"></select>
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button type="button" onclick="signAndSubmit()">–ü–æ–¥–ø–∏—Å–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <script>
        const plugin = new CAdESPlugin('https://localhost:8001/rpc');

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async () => {
            const certs = await plugin.listCertificates();
            const select = document.getElementById('certificate');

            certs.certificates.forEach(cert => {
                const option = document.createElement('option');
                option.value = cert.thumbprint;
                option.textContent = cert.subject_cn;
                select.appendChild(option);
            });
        });

        async function signAndSubmit() {
            const document = document.getElementById('document').value;
            const thumbprint = document.getElementById('certificate').value;
            const password = document.getElementById('password').value;

            // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
            const result = await plugin.signData(document, thumbprint, password);

            if (result.success) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                await fetch('/submit', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        document: document,
                        signature: result.signature
                    })
                });

                alert('–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
            } else {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏: ' + result.error);
            }
        }
    </script>
</body>
</html>
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Django

```python
from django.http import JsonResponse
from django.views import View
import httpx
import base64

class SignDocumentView(View):
    async def post(self, request):
        document = request.POST.get('document')
        thumbprint = request.POST.get('thumbprint')
        password = request.POST.get('password')

        # –ö–æ–¥–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –≤ base64
        document_b64 = base64.b64encode(document.encode()).decode()

        # –í—ã–∑—ã–≤–∞–µ–º CAdES Plugin —á–µ—Ä–µ–∑ RPC
        async with httpx.AsyncClient() as client:
            response = await client.post('https://localhost:8001/rpc', json={
                'method': 'cades_plugin/sign_data',
                'params': {
                    'data_base64': document_b64,
                    'thumbprint': thumbprint,
                    'password': password,
                    'detached': True
                },
                'id': 'req_1'
            })

            result = response.json()

            if result['result']['success']:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥–ø–∏—Å—å –≤ –ë–î
                signature = result['result']['signature']
                # ...

                return JsonResponse({'success': True, 'signature': signature})
            else:
                return JsonResponse({'success': False, 'error': result['result']['error']})
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è pull request'—ã –∏ issue reports!

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Internal P2P Core Team service

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

P2P Core Team - –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [cryptography](https://cryptography.io/) - –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- P2P Core Team - –∑–∞ framework –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É
